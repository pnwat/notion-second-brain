name: Sync to Notion

on:
  workflow_dispatch:
    inputs:
      action:
        description: 'Action to perform'
        required: true
        default: 'add'
      title:
        description: 'Title of the note'
        required: false
      content:
        description: 'Content of the note'
        required: false
      category:
        description: 'Category'
        required: false
      tags:
        description: 'Tags (comma separated)'
        required: false
      template:
        description: 'Template name to use'
        required: false
      subAction:
        description: 'Sub-action for manage_template (list/get/save)'
        required: false
      name:
        description: 'Name for manage_template'
        required: false
      mode:
        description: 'Update mode (append/replace)'
        required: false
      section:
        description: 'Section to append to (for update)'
        required: false
        default: ''

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Execute Action
        env:
          NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
          NOTION_DB_ID: ${{ secrets.NOTION_DB_ID }}
          ACTION: ${{ inputs.action }}
          TITLE: ${{ inputs.title }}
          CONTENT: ${{ inputs.content }}
          CATEGORY: ${{ inputs.category }}
          TAGS: ${{ inputs.tags }}
          TEMPLATE: ${{ inputs.template }}
          SUB_ACTION: ${{ inputs.subAction }}
          NAME: ${{ inputs.name }}
          MODE: ${{ inputs.mode }}
          SECTION: ${{ inputs.section }}
        run: node src/index.js
