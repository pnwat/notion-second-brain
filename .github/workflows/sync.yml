name: Sync to Notion

on:
  workflow_dispatch:
    inputs:
      action:
        description: 'Action to perform (add, update, search, list_recent, batch_update)'
        required: true
        default: 'search'
      title:
        description: 'Title of the note (for add/update)'
        required: false
      content:
        description: 'Content of the note (for add/update)'
        required: false
      category:
        description: 'Category of the note (for add/update)'
        required: false
      tags:
        description: 'Tags (comma separated) (for add/update)'
        required: false
      pageId:
        description: 'Page ID (for update)'
        required: false
      query:
        description: 'Search query (for search)'
        required: false
      limit:
        description: 'Number of notes to return (for list_recent)'
        required: false
        default: '10'
      updates:
        description: 'JSON array of updates for batch_update action'
        required: false
      mode:
        description: 'Update mode: append or replace'
        required: false
        default: 'append'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Execute Action
        env:
          NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
          NOTION_DB_ID: ${{ secrets.NOTION_DB_ID }}
          ACTION: ${{ inputs.action }}
          TITLE: ${{ inputs.title }}
          CONTENT: ${{ inputs.content }}
          CATEGORY: ${{ inputs.category }}
          TAGS: ${{ inputs.tags }}
          PAGE_ID: ${{ inputs.pageId }}
          QUERY: ${{ inputs.query }}
          LIMIT: ${{ inputs.limit }}
          UPDATES: ${{ inputs.updates }}
          MODE: ${{ inputs.mode }}
        run: node src/index.js
